<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Flow Learning æµå‹•å¼å­¸ç¿’å¹³å°</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* --- å…¨åŸŸè¨­å®šèˆ‡è®Šæ•¸ --- */
:root {
    --primary: #007bff;
    --primary-dark: #0056b3;
    --secondary: #6c757d;
    --success: #28a745;
    --success-light: #d4edda;
    --success-text: #155724;
    --danger: #dc3545;
    --warning: #ffc107;
    --bg-color: #f0f2f5;
    --card-bg: #ffffff;
    --text-main: #2c3e50;
    --text-sub: #666;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
    --shadow-md: 0 8px 16px rgba(0,0,0,0.1);
    --shadow-lg: 0 12px 24px rgba(0,0,0,0.15);
    --anim-speed: 0.3s;
    --anim-bezier: cubic-bezier(0.4, 0, 0.2, 1);
    --fire-color: #ff5722;
}

*{box-sizing:border-box;font-family:'Segoe UI', 'Microsoft JhengHei', sans-serif;margin:0;padding:0; -webkit-tap-highlight-color: transparent;}
body{background:var(--bg-color); color:var(--text-main); line-height: 1.6; overflow-x: hidden;}

/* --- å‹•ç•«å®šç¾© --- */
@keyframes fadeInUp { from { opacity: 0; transform: translate3d(0, 20px, 0); } to { opacity: 1; transform: translate3d(0, 0, 0); } }
@keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
@keyframes slideInRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
@keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0px); } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 50% { transform: translateX(8px); } 75% { transform: translateX(-8px); } }
@keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
@keyframes expandOpen { from { max-height: 0; opacity: 0; transform: translateY(-10px); } to { max-height: 500px; opacity: 1; transform: translateY(0); } }
@keyframes fire-pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(255, 87, 34, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0); } }

/* å½ˆè·³å‹•ç•« */
@keyframes bounce-click {
    0% { transform: scale(1); }
    40% { transform: scale(1.03); background-color: #e3f2fd; }
    100% { transform: scale(1); background-color: #fff; }
}
.bounce-active { animation: bounce-click 0.4s ease-out; }

/* Tips å‹•ç•« */
.tip-enter { animation: slideUpIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
.tip-exit { animation: slideUpOut 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
@keyframes slideUpIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideUpOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-10px); } }

/* --- Header --- */
header{ background:var(--card-bg); padding:20px 25px 15px 25px; text-align:center; box-shadow: var(--shadow-sm); border-bottom: 3px solid var(--primary); position: relative; z-index: 200; transition: all var(--anim-speed) ease; }
header h1{ font-size:26px; margin-bottom:5px; color: var(--text-main); font-weight: 700; letter-spacing: 0.5px; transition: color 0.3s; }
header:hover h1 { color: var(--primary); }

.tips-container { display: inline-flex; align-items: center; background: #e3f2fd; color: #055160; padding: 6px 15px; border-radius: 20px; font-size: 13px; font-weight: 500; box-shadow: 0 2px 5px rgba(0,0,0,0.05); max-width: 90%; margin-top: 5px; }
.tips-icon { margin-right: 8px; font-size: 14px; }
.tips-content { display: inline-block; min-width: 200px; text-align: left; }

/* --- Nav --- */
nav{ background:rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); padding:0; text-align:center; box-shadow: var(--shadow-sm); position:sticky; top:0; z-index:100; white-space: nowrap; overflow-x: auto; display: flex; justify-content: center; }
nav a{ position: relative; padding: 15px 20px; cursor:pointer; color:#555; text-decoration:none; font-weight:600; font-size: 15px; transition: color 0.3s ease; display: inline-block; }
nav a::after { content: ''; position: absolute; width: 0; height: 3px; bottom: 0; left: 50%; background-color: var(--primary); transition: all 0.3s ease; transform: translateX(-50%); }
nav a:hover { color: var(--primary); background-color: rgba(0,123,255,0.05); }
nav a:hover::after { width: 80%; }
nav a.active { color: var(--primary); }
nav a.active::after { width: 80%; }

/* --- Page & Cards --- */
.page { display:none; max-width:800px; margin:25px auto; padding:0 20px; animation: fadeInUp 0.5s var(--anim-bezier); }
.card { background:var(--card-bg); padding:25px; border-radius:16px; box-shadow: var(--shadow-sm); margin-bottom:20px; transition: all 0.3s var(--anim-bezier); border: 1px solid transparent; position: relative; overflow: hidden; }
.card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); border-color: rgba(0,123,255,0.2); }

/* --- Inputs & Buttons --- */
input, textarea, select { width:100%; padding:12px 15px; margin-top:10px; border-radius:10px; border:2px solid #eee; font-size:16px; outline: none; background: #fafafa; transition: all 0.3s ease; }
input:focus, textarea:focus, select:focus { border-color: var(--primary); background: #fff; box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.1); transform: scale(1.01); }
button { width:100%; padding:12px; margin-top:15px; border-radius:10px; background:var(--primary); color:#fff; border:none; cursor:pointer; font-weight:bold; font-size: 16px; position: relative; overflow: hidden; transition: all 0.2s ease; box-shadow: 0 4px 6px rgba(0,123,255,0.2); }
button:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,123,255,0.3); }
button:active { transform: translateY(1px) scale(0.98); box-shadow: 0 2px 4px rgba(0,123,255,0.2); }
button.secondary { background: #e9ecef; color: #495057; box-shadow: none; }
button.secondary:hover { background: #dee2e6; color: #212529; }
button.outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); box-shadow: none; }
button.outline:hover { background: #f0f8ff; color: var(--primary-dark); }

/* çè—èˆ‡ç«ç„°æŒ‰éˆ• */
.action-btn-group { display: flex; gap: 10px; }
.icon-btn {
    display: inline-flex; align-items: center; justify-content: center;
    width: auto; padding: 5px 15px; margin-top: 0;
    font-size: 14px; border-radius: 20px; transition: all 0.3s;
    background: transparent;
}
/* çè— */
.fav-btn { border: 1px solid #dc3545; color: #dc3545; }
.fav-btn.active { background: #dc3545; color: white; }
/* ç«ç„° (ç†±åº¦) */
.heat-btn { border: 1px solid var(--fire-color); color: var(--fire-color); }
.heat-btn.active { background: var(--fire-color); color: white; animation: fire-pulse 0.6s; }
.heat-btn span { margin-left: 5px; font-weight: bold; }

/* --- Quiz --- */
.quiz-section { background: #f8f9fa; border: 2px dashed #007bff; border-radius: 12px; padding: 20px; margin-top: 20px; }
.quiz-container { margin-top: 30px; padding: 25px; background: #fff; border-radius: 12px; border: 1px solid #e9ecef; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; overflow: hidden; }
.quiz-container::before { content: 'éš¨å ‚å°æ¸¬é©—'; position: absolute; top: 0; left: 0; background: var(--warning); color: #333; padding: 5px 15px; font-size: 12px; font-weight: bold; border-bottom-right-radius: 12px; }
.quiz-question { font-size: 18px; font-weight: bold; color: #2c3e50; margin: 15px 0 20px 0; }
.quiz-options { display: flex; flex-direction: column; gap: 10px; }
.quiz-btn { background: #fff; color: #555; border: 2px solid #e9ecef; text-align: left; padding: 15px; transition: all 0.2s; position: relative; box-shadow: none; margin-top: 0; }
.quiz-btn:hover { border-color: var(--primary); background: #f0f8ff; transform: translateX(5px); color: var(--primary); box-shadow: none; }
.quiz-btn.correct { background: var(--success); color: #fff; border-color: var(--success); animation: pop 0.4s ease; }
.quiz-btn.correct::after { content: 'âœ“'; position: absolute; right: 20px; font-weight: bold; }
.quiz-btn.wrong { background: var(--danger); color: #fff; border-color: var(--danger); animation: shake 0.5s ease; }
.quiz-btn.wrong::after { content: 'âœ•'; position: absolute; right: 20px; font-weight: bold; }
.quiz-feedback { margin-top: 20px; padding: 15px; background: #e8f5e9; border-left: 5px solid var(--success); border-radius: 5px; color: #2e7d32; display: none; }
.quiz-feedback.show { display: block; animation: expandOpen 0.5s ease forwards; }
.quiz-feedback.error-feedback { background: #ffebee; border-left-color: var(--danger); color: #c62828; }

/* --- List Items --- */
.article-item { cursor: pointer; opacity: 0; animation: fadeInUp 0.5s forwards; }
.article-item h3 { color:var(--text-main); margin-bottom: 8px; font-size: 20px; transition: color 0.2s; display: flex; align-items: center; gap: 8px; }
.article-item:hover h3 { color: var(--primary); }
.article-desc { color:var(--text-sub); font-size:14px; margin-bottom: 10px; }
.article-meta { font-size: 12px; color: #999; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;}
.heat-badge { color: var(--fire-color); font-weight: bold; font-size: 13px; display: flex; align-items: center; }

/* Tags */
.tag-container { margin-top: 8px; }
.tag { display: inline-block; background: #e3f2fd; color: var(--primary); padding: 4px 12px; border-radius: 20px; font-size: 12px; margin-right: 6px; cursor: pointer; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 1px solid transparent; }
.tag:hover { background: var(--primary); color: #fff; transform: scale(1.1); box-shadow: 0 2px 5px rgba(0,123,255,0.3); }
.hot-tags { margin-bottom: 20px; padding: 20px; background: #fff; border-radius: 12px; box-shadow: var(--shadow-sm); animation: scaleIn 0.4s ease-out; }

/* Dashboard */
.stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px; }
.stat-box { background: #fff; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #e9ecef; transition: transform 0.3s ease; animation: float 6s ease-in-out infinite; }
.stat-box:nth-child(2) { animation-delay: 1s; }
.stat-box:nth-child(3) { animation-delay: 2s; }
.stat-box:hover { transform: translateY(-5px) scale(1.05); border-color: var(--primary); }
.stat-box h4 { font-size: 13px; color: #666; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
.stat-box span { font-size: 28px; font-weight: 800; color: var(--primary); display: block; }

.progress-container { margin-bottom: 25px; }
.progress-bar { background: #e9ecef; height: 12px; border-radius: 6px; overflow: hidden; margin-top: 8px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
.progress-fill { background: linear-gradient(90deg, #28a745, #20c997); height: 100%; width: 0%; transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1); position: relative; }
.progress-fill::after { content: ''; position: absolute; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%); transform: translateX(-100%); animation: shimmer 2s infinite; }
@keyframes shimmer { 100% { transform: translateX(100%); } }

.history-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 10px; font-size: 14px; }
.history-table th { text-align: left; padding: 10px; color: #666; font-weight: 600; }
.history-table tr { background: #fff; transition: transform 0.2s; }
.history-table tr td { padding: 15px; border-top: 1px solid #f0f0f0; border-bottom: 1px solid #f0f0f0; }
.history-table tr td:first-child { border-left: 1px solid #f0f0f0; border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
.history-table tr td:last-child { border-right: 1px solid #f0f0f0; border-top-right-radius: 8px; border-bottom-right-radius: 8px; }
.history-table tbody tr:hover { transform: scale(1.02); box-shadow: var(--shadow-sm); z-index: 10; position: relative; }

/* Chat & Comments */
#detailComments, #chatBox { height: 350px; overflow-y: auto; border: 1px solid #eee; padding: 20px; border-radius: 12px; background: #fafafa; margin-bottom: 15px; scroll-behavior: smooth; }
.chat-msg { margin-bottom: 12px; font-size: 15px; padding: 10px 15px; background: #fff; border-radius: 12px; border-bottom-left-radius: 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); display: inline-block; max-width: 80%; animation: fadeInUp 0.3s ease-out; }
.my-msg { text-align: right; background: #e3f2fd; border-bottom-left-radius: 12px; border-bottom-right-radius: 2px; float: right; clear: both; }
.chat-wrapper { overflow: hidden; }
.comment { padding: 15px; border-bottom: 1px solid #eee; background: #fff; border-radius: 8px; margin-bottom: 10px; animation: slideInRight 0.4s ease-out; cursor: pointer; transition: background-color 0.2s; }
.comment:hover { background-color: #f8f9fa; }
.comment strong { color: var(--primary); }

/* Misc */
.search-container { display: flex; gap: 10px; margin-bottom: 15px; }
.search-container input { margin-top: 0; border-radius: 50px; padding-left: 20px; }
.search-container button { width: auto; margin-top: 0; padding: 0 25px; border-radius: 50px; }
.filter-tabs { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
.filter-btn { padding: 6px 15px; border-radius: 20px; border: 1px solid #ddd; background: #fff; color: #555; cursor: pointer; font-size: 14px; white-space: nowrap; margin-top: 0; width: auto; box-shadow: none; }
.filter-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }

.error-msg { display: none; background-color: #fff1f2; color: #e11d48; padding: 15px; border-radius: 10px; border: 1px solid #fecdd3; margin-top: 15px; font-size: 14px; text-align: center; animation: shake 0.5s; box-shadow: 0 4px 6px rgba(225, 29, 72, 0.1); }
#userStatus { position: absolute; top: 25px; right: 25px; font-size: 14px; color: #888; font-weight: 500; }
.auth-toggle { text-align: center; margin-top: 15px; font-size: 14px; color: #666; }
.auth-toggle span { color: var(--primary); cursor: pointer; font-weight: bold; position: relative; }
.auth-toggle span::after { content: ''; position: absolute; width: 100%; height: 1px; bottom: 0; left: 0; background: var(--primary); transform: scaleX(0); transition: transform 0.3s; }
.auth-toggle span:hover::after { transform: scaleX(1); }

@media (max-width: 600px) {
    #userStatus { display: none; }
    nav { justify-content: flex-start; padding: 0 10px; }
    .stat-grid { grid-template-columns: 1fr; }
    .history-table th:nth-child(2), .history-table td:nth-child(2) { display: none; }
}
</style>
</head>
<body>

<header>
  <h1>Flow Learning è—¥ç‰©å­¸ç¿’å¹³å°</h1>
  <p>æµå‹•å¼å­¸ç¿’ Ã— çŸ¥è­˜å…±äº« Ã— ç¤¾ç¾¤å…±å‰µ</p>
  
  <div class="tips-container">
      <span class="tips-icon">ğŸ’¡ é†«è­·å°çŸ¥è­˜ï¼š</span>
      <div class="tips-content">
          <span id="tipsText">æ¯å¤©å–æ°´ 2000cc ä¿ƒé€²æ–°é™³ä»£è¬</span>
      </div>
  </div>

  <div id="userStatus"></div>
</header>

<nav>
  <a onclick="showPage('explore')" id="nav-explore">ğŸ“– èª²ç¨‹ç€è¦½</a>
  <a onclick="showPage('publish')" id="nav-publish">âœï¸ ç™¼å¸ƒæ–‡ç« </a>
  <a onclick="showPage('chatroom')" id="nav-chatroom">ğŸ’¬ ç¤¾ç¾¤èŠå¤©å®¤</a>
  <a onclick="showPage('account')" id="nav-account">ğŸ“Š å€‹äººå„€è¡¨æ¿</a>
  <a onclick="showPage('login')" id="nav-login">ğŸ‘¤ ç™»å…¥/è¨»å†Š</a>
</nav>

<!-- 1. ç™»å…¥/è¨»å†Šé  -->
<div id="login" class="page" style="display:block;">
  <div id="loginForm" class="card" style="max-width:400px; margin: 40px auto; animation-delay: 0.1s;">
    <h2 style="text-align:center; margin-bottom:20px; color:#2c3e50;">æœƒå“¡ç™»å…¥</h2>
    <input id="loginUser" placeholder="è¼¸å…¥å¸³è™Ÿ">
    <input id="loginPass" type="password" placeholder="è¼¸å…¥å¯†ç¢¼">
    <button onclick="performLogin()">ç™»å…¥ç³»çµ±</button>
    <div id="loginError" class="error-msg">âš ï¸ <strong>ç™»å…¥å¤±æ•—</strong><br>æ‰¾ä¸åˆ°æ­¤å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ã€‚<br>è‹¥ç„¡å¸³è™Ÿè«‹é»é¸ä¸‹æ–¹ã€Œç«‹å³è¨»å†Šã€ã€‚</div>
    <div class="auth-toggle">é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿ <span onclick="toggleAuthMode('register')">ç«‹å³è¨»å†Š</span></div>
  </div>

  <div id="registerForm" class="card" style="max-width:400px; margin: 40px auto; display:none; animation-delay: 0.1s;">
    <h2 style="text-align:center; margin-bottom:20px; color:var(--success);">æ–°æœƒå“¡è¨»å†Š</h2>
    <p style="font-size:13px; color:#666; margin-bottom:10px;">è¨»å†Šå¾Œå³å¯ç™¼å¸ƒæ–‡ç« èˆ‡ç´¯ç©å­¸ç¿’æ­·ç¨‹ã€‚</p>
    <input id="regUser" placeholder="è¨­å®šå¸³è™Ÿ">
    <input id="regPass" type="password" placeholder="è¨­å®šå¯†ç¢¼">
    <button onclick="performRegister()" style="background:var(--success);">ç¢ºèªè¨»å†Š</button>
    <div class="auth-toggle">å·²æœ‰å¸³è™Ÿï¼Ÿ <span onclick="toggleAuthMode('login')">è¿”å›ç™»å…¥</span></div>
  </div>
</div>

<!-- 2. å€‹äººå„€è¡¨æ¿ -->
<div id="account" class="page">
  <div class="card" style="animation-delay: 0.1s;">
    <h2 style="margin-bottom: 20px; border-left: 5px solid var(--primary); padding-left: 10px;">å€‹äººå­¸ç¿’æ­·ç¨‹æª”æ¡ˆ</h2>
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <p>å­¸å“¡ï¼š<span id="accountName" style="font-weight:bold; font-size: 18px;">è¨ªå®¢</span></p>
        <span style="font-size:12px; color:#888; background:#eee; padding:4px 10px; border-radius:20px;">ID: <span id="accountId">--</span></span>
    </div>

    <!-- ä¿®æ”¹æš±ç¨±å€å¡Š -->
    <div style="background:#f8f9fa; padding:15px; border-radius:10px; margin-bottom:20px; border:1px solid #eee;">
        <h4 style="font-size:14px; margin-bottom:10px; color:#555;">âš™ï¸ ä¿®æ”¹ç”¨æˆ¶åç¨±</h4>
        <div style="display:flex; gap:10px;">
            <input id="newUsername" placeholder="è¼¸å…¥æ–°çš„é¡¯ç¤ºåç¨±" style="margin-top:0; background:#fff;">
            <button onclick="changeUsername()" style="width:100px; margin-top:0;" class="outline">å„²å­˜</button>
        </div>
    </div>
    
    <div class="stat-grid">
        <div class="stat-box">
            <h4>å·²å®Œæˆå–®å…ƒ</h4>
            <span id="readCount">0</span> ç¯‡
        </div>
        <div class="stat-box">
            <h4>ç¸½å­¸ç¿’æ™‚é–“</h4>
            <span id="totalTime">0</span> åˆ†é˜
        </div>
        <div class="stat-box">
            <h4>ç¤¾ç¾¤è²¢ç»</h4>
            <span id="contributionScore">Lv. 1</span>
        </div>
    </div>

    <div class="progress-container">
        <h4 style="color:#444; margin-bottom:5px;">æœ¬é€±å­¸ç¿’ç›®æ¨™é”æˆç‡ (<span id="progressText">0</span>%)</h4>
        <div class="progress-bar"><div id="progressBar" class="progress-fill" style="width: 0%;"></div></div>
    </div>

    <h3 style="font-size: 18px; margin-bottom: 15px; color: #2c3e50;">ğŸ“š å­¸ç¿’æª”æ¡ˆç´€éŒ„</h3>
    <div style="overflow-x:auto;">
        <table class="history-table">
            <thead>
                <tr>
                    <th width="40%">å–®å…ƒä¸»é¡Œ</th>
                    <th width="20%">å­¸ç¿’æ—¥æœŸ</th>
                    <th width="20%">å­¸ç¿’æ™‚é•·</th>
                    <th width="20%">æ¸¬é©—ç‹€æ…‹</th> 
                </tr>
            </thead>
            <tbody id="historyList">
                <tr><td colspan="4" style="text-align:center; color:#999;">å°šæœªé–‹å§‹å­¸ç¿’</td></tr>
            </tbody>
        </table>
    </div>

    <hr style="margin: 25px 0; border: 0; border-top: 1px solid #eee;">
    <button onclick="performLogout()" style="background: #e11d48;">ç™»å‡ºç³»çµ±</button>
  </div>
</div>

<!-- 3. ç™¼å¸ƒæ–‡ç« é  -->
<div id="publish" class="page">
    <div class="card" style="animation-delay: 0.1s;">
        <h2 style="margin-bottom: 20px; border-left: 5px solid #6f42c1; padding-left: 10px;">ç™¼å¸ƒé†«è­·çŸ¥è­˜æ–‡ç« </h2>
        <p style="color:#666; font-size:14px; margin-bottom:15px;">æ­¡è¿åˆ†äº«æ‚¨çš„é†«è­·ç¶“é©—æˆ–å­¸ç¿’ç­†è¨˜ï¼Œè«‹å–„ç”¨ #Hashtag æ¨™ç±¤åŠŸèƒ½ã€‚</p>
        
        <input id="pubTitle" placeholder="è«‹è¼¸å…¥æ–‡ç« æ¨™é¡Œ">
        <textarea id="pubContent" rows="10" placeholder="è«‹è¼¸å…¥æ–‡ç« å…§å®¹..."></textarea>
        <input id="pubTags" placeholder="è¼¸å…¥æ¨™ç±¤ (ä¾‹å¦‚: #æ„Ÿå†’ #è­·ç† #ç”¨è—¥å®‰å…¨)ï¼Œä»¥ç©ºæ ¼åˆ†éš”">
        
        <div class="quiz-section">
            <h3 style="color: #495057; font-size: 18px; margin-bottom: 15px;">ğŸ“ æ–°å¢éš¨å ‚å°æ¸¬é©— (é¸å¡«)</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">åŠ å…¥æ¸¬é©—å¯å¢åŠ è®€è€…äº’å‹•ï¼Œè«‹è¨­å®šä¸€é¡Œé¸æ“‡é¡Œã€‚</p>
            <input id="quizQuestion" placeholder="è¼¸å…¥æ¸¬é©—é¡Œç›® (ä¾‹å¦‚: æ„Ÿå†’è—¥å¯ä»¥æ®ºæ­»ç—…æ¯’å—ï¼Ÿ)">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                <input id="quizOpt1" placeholder="é¸é … 1">
                <input id="quizOpt2" placeholder="é¸é … 2">
                <input id="quizOpt3" placeholder="é¸é … 3">
                <input id="quizOpt4" placeholder="é¸é … 4">
            </div>
            <div style="margin-top: 10px;">
                <label style="font-size: 14px; font-weight: bold; color: #666;">æ­£ç¢ºç­”æ¡ˆï¼š</label>
                <select id="quizCorrect" style="margin-top: 5px;">
                    <option value="0">é¸é … 1</option>
                    <option value="1">é¸é … 2</option>
                    <option value="2">é¸é … 3</option>
                    <option value="3">é¸é … 4</option>
                </select>
            </div>
            <textarea id="quizExplanation" rows="3" placeholder="è¼¸å…¥è§£æï¼šç‚ºä»€éº¼é€™å€‹ç­”æ¡ˆæ˜¯æ­£ç¢ºçš„ï¼Ÿ"></textarea>
        </div>
        <button onclick="submitArticle()" style="background:#6f42c1;">âœ¨ ç«‹å³ç™¼å¸ƒæ–‡ç« </button>
    </div>
</div>

<!-- 4. èª²ç¨‹ç€è¦½ -->
<div id="explore" class="page">
    <div class="hot-tags" style="animation-delay: 0.1s;">
        <h4>ğŸ”¥ ç†±é–€æª¢ç´¢ï¼š</h4>
        <span id="hotTagsContainer"></span>
    </div>
    
    <div class="filter-tabs" style="animation: fadeInUp 0.5s ease-out 0.1s backwards;">
        <button class="filter-btn active" onclick="setFilter('all', this)">å…¨éƒ¨æ–‡ç« </button>
        <button class="filter-btn" onclick="setFilter('favorites', this)">â­ æˆ‘çš„çè—</button>
    </div>

    <div class="search-container" style="animation: fadeInUp 0.5s ease-out 0.2s backwards;">
        <input id="searchInput" placeholder="ğŸ” æœå°‹æ–‡ç« æ¨™é¡Œæˆ–æ¨™ç±¤..." oninput="filterArticles()">
        <button onclick="filterArticles()" style="width: auto;">æœå°‹</button>
    </div>
    <div id="articleList"></div>
</div>

<!-- 5. å…§å®¹è©³æƒ… -->
<div id="detail" class="page">
  <div class="card" style="animation-delay: 0.1s;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
        <button class="secondary" onclick="showPage('explore')" style="width:auto; padding: 8px 20px; border-radius: 50px; margin:0;">â† çµæŸé–±è®€</button>
        <div class="action-btn-group">
            <button id="heatBtn" class="icon-btn heat-btn" onclick="toggleHeat()">ğŸ”¥ ç†±åº¦ <span id="heatCount">0</span></button>
            <button id="favBtn" class="icon-btn fav-btn" onclick="toggleFavorite()">â™¡ çè—</button>
        </div>
    </div>
    
    <h2 id="detailTitle" style="color: var(--primary); margin-bottom: 5px; font-size: 26px;"></h2>
    <div id="detailMeta" class="article-meta"></div>
    <div id="detailTags" class="tag-container" style="margin-bottom:20px;"></div>
    <div style="height: 4px; width: 50px; background: var(--primary); margin-bottom: 25px; border-radius: 2px;"></div>
    <p id="detailContent" style="line-height:1.8; color: #444; font-size: 18px; white-space: pre-line;"></p>
    <div id="detailQuiz"></div>
  </div>
  <div class="card" style="animation-delay: 0.2s;">
    <h3>ğŸ’¬ å…±å‰µç•™è¨€æ¿</h3>
    <p style="font-size:13px; color:#888; margin-bottom:10px;">é»æ“Šç•™è¨€å¯ç›´æ¥å›è¦†è©²æ¨“å±¤</p>
    <div id="detailComments"></div>
    <input id="commentInput" placeholder="åˆ†äº«ä½ çš„çœ‹æ³•..." onkeydown="addComment(event)">
  </div>
</div>

<!-- 6. ç¤¾ç¾¤èŠå¤©å®¤ -->
<div id="chatroom" class="page">
    <div class="card" style="height: calc(100vh - 140px); display: flex; flex-direction: column; animation-delay: 0.1s;">
        <h2 style="margin-bottom: 5px; border-left: 5px solid var(--success); padding-left: 10px;">ç¤¾ç¾¤å³æ™‚èŠå¤©å®¤</h2>
        <p style="font-size: 13px; color: #888; margin-bottom: 15px;">ğŸŸ¢ ç›®å‰æœ‰ 12 ä½å­¸ç¿’è€…èˆ‡è—¥å¸«åœ¨ç·š</p>
        <div id="chatBox" style="flex: 1; height: auto;">
            <div class="chat-wrapper"><div class="chat-msg"><strong>ç³»çµ±æ©Ÿå™¨äººï¼š</strong> æ­¡è¿ä¾†åˆ° Flow Learning è¨è«–å€ï¼</div></div>
        </div>
        <div style="display: flex; gap: 10px; margin-top: auto;">
            <input id="chatInput" placeholder="è¼¸å…¥è¨Šæ¯åƒèˆ‡è¨è«–..." style="margin-top:0;">
            <button onclick="sendChat()" style="width: 100px; margin-top:0;">ç™¼é€</button>
        </div>
    </div>
</div>

<script>
// å…¨åŸŸè®Šæ•¸
let currentUserData = null;
let currentArticle = null;
let sessionStartTime = 0;
let allArticles = [];
let currentFilter = 'all'; 

/* é è¨­æ–‡ç«  */
const defaultArticles = [
  { id: 1, title: "æ„Ÿå†’æ­£ç¢ºç”¨è—¥çŸ¥å¤šå°‘", author: "è¡›ç¦éƒ¨é£Ÿè—¥ç½²", tags: ["#æ„Ÿå†’", "#ç”¨è—¥å®‰å…¨", "#è¡›æ•™"], content: "ã€æ ¸å¿ƒè§€å¿µã€‘\né£Ÿå“è—¥ç‰©ç®¡ç†ç½²æé†’æ°‘çœ¾...", comments: ["æˆ‘è¦ºå¾—å¤šå–æ°´æœ€é‡è¦ã€‚"], quiz: { question: "ç¶œåˆæ„Ÿå†’è—¥çš„ä¸»è¦åŠŸèƒ½æ˜¯ä»€éº¼ï¼Ÿ", options: ["æ®ºæ­»æ„Ÿå†’ç—…æ¯’", "ç·©è§£æ„Ÿå†’ç—‡ç‹€", "ç¸®çŸ­æ„Ÿå†’ç—…ç¨‹", "å¢å¼·å…ç–«åŠ›"], correctAnswerIndex: 1, explanation: "æ­£ç¢ºè§£æï¼šç¶œåˆæ„Ÿå†’è—¥åƒ…èƒ½ã€Œç·©è§£ã€ä¸é©ç—‡ç‹€..." } },
  { id: 2, title: "å¿ƒè¡€ç®¡ç”¨è—¥æ³¨æ„äº‹é …", author: "å°ˆæ¥­è—¥å¸«åœ˜éšŠ", tags: ["#å¿ƒè¡€ç®¡", "#æ…¢æ€§ç—…"], content: "ã€æœç”¨é ˆçŸ¥ã€‘\nå¿ƒè¡€ç®¡ç–¾ç—…æ‚£è€…é™¤äº†æ³¨é‡æ—¥å¸¸ä¿é¤Š...", comments: ["è‘¡è„æŸšçœŸçš„å¾ˆå®¹æ˜“è¢«å¿½ç•¥ï¼"] },
  { id: 3, title: "æŠ—ç”Ÿç´ ä½¿ç”¨çš„äº”å¤§è¿·æ€", author: "Dr. Chen", tags: ["#æŠ—ç”Ÿç´ ", "#è¿·æ€ç ´è§£"], content: "ã€è¿·æ€ä¸€ï¼šç—‡ç‹€å¥½äº†å°±å¯ä»¥åœè—¥ï¼Ÿã€‘\néŒ¯ï¼æŠ—ç”Ÿç´ å¿…é ˆæŒ‰ç…§...", comments: ["çœŸçš„å¾ˆå¤šäººæœƒäº‚åœè—¥ã€‚"] }
];

/* åˆå§‹åŒ–èˆ‡ç†±åº¦è®€å– */
function getArticleHeat(id) {
    const heatMap = JSON.parse(localStorage.getItem('flowLearningArticleHeat') || "{}");
    return heatMap[id] || 0;
}

function updateArticleHeat(id, change) {
    const heatMap = JSON.parse(localStorage.getItem('flowLearningArticleHeat') || "{}");
    heatMap[id] = (heatMap[id] || 0) + change;
    if(heatMap[id] < 0) heatMap[id] = 0;
    localStorage.setItem('flowLearningArticleHeat', JSON.stringify(heatMap));
    return heatMap[id];
}

function initArticles() {
    allArticles = [...defaultArticles];
    const userPosted = localStorage.getItem('flowLearningUserArticles');
    if (userPosted) {
        allArticles = [...JSON.parse(userPosted), ...allArticles];
    }
}

/* Tips */
const tipsData = [ "æ¯å¤©å–æ°´ 2000cc ä¿ƒé€²æ–°é™³ä»£è¬ã€‚", "è—¥ç‰©æ‡‰é…ç™½é–‹æ°´æœç”¨ã€‚", "æŠ—ç”Ÿç´ éœ€æŒ‰ç™‚ç¨‹æœç”¨å®Œç•¢ã€‚", "é‹å‹•å¾Œè£œå……è›‹ç™½è³ªã€‚", "æ¯å¹´å®šæœŸé€²è¡Œå¥åº·æª¢æŸ¥ã€‚" ];
let currentTipIndex = 0;
function startTipsRotation() {
    const el = document.getElementById('tipsText');
    if(!el) return;
    setInterval(() => {
        el.className = 'tip-exit';
        setTimeout(() => {
            currentTipIndex = (currentTipIndex + 1) % tipsData.length;
            el.innerText = tipsData[currentTipIndex];
            el.className = 'tip-enter';
        }, 500);
    }, 5000);
}

/* æœƒå“¡å­˜å– */
function getUsersDB() { return JSON.parse(localStorage.getItem('flowLearningDB') || "{}"); }
function saveUsersDB(db) { localStorage.setItem('flowLearningDB', JSON.stringify(db)); }
function saveUserData() {
    if(currentUserData) {
        const db = getUsersDB();
        const userKey = currentUserData.originalUsername || currentUserData.username; 
        const dataToSave = JSON.parse(JSON.stringify(currentUserData));
        delete dataToSave.originalUsername; 
        db[userKey] = dataToSave;
        saveUsersDB(db);
    }
}

function saveReadingProgress() {
    if (sessionStartTime > 0 && currentUserData && currentArticle) {
        const durationSeconds = Math.floor((Date.now() - sessionStartTime) / 1000);
        if(durationSeconds < 1) return; 

        currentUserData.totalLearningSeconds += durationSeconds;
        let record = currentUserData.learningHistory.find(h => h.articleId === currentArticle.id);
        const nowStr = new Date().toLocaleString();

        if (record) {
            record.lastAccess = nowStr;
            record.timeSpentSeconds += durationSeconds;
        } else {
            record = { articleId: currentArticle.id, title: currentArticle.title, lastAccess: nowStr, timeSpentSeconds: durationSeconds, quizPassed: false };
            currentUserData.learningHistory.unshift(record);
        }
        saveUserData();
    }
    sessionStartTime = 0; 
}

function performLogin() {
    const user = document.getElementById("loginUser").value.trim();
    const pass = document.getElementById("loginPass").value.trim();
    const db = getUsersDB();
    if (db[user] && db[user].password === pass) {
        currentUserData = { ...db[user], username: user, favorites: db[user].favorites || [], likedArticles: db[user].likedArticles || [] };
        if (!currentUserData.favorites) currentUserData.favorites = [];
        if (!currentUserData.likedArticles) currentUserData.likedArticles = [];
        updateUserUI();
        initArticles();
        showPage("explore");
    } else { document.getElementById("loginError").style.display = 'block'; }
}
function performRegister() {
    const user = document.getElementById("regUser").value.trim();
    const pass = document.getElementById("regPass").value.trim();
    if (!user || !pass) { alert("è«‹è¼¸å…¥å®Œæ•´è³‡è¨Š"); return; }
    const db = getUsersDB();
    if (db[user]) { alert("å¸³è™Ÿå·²å­˜åœ¨"); return; }
    db[user] = { password: pass, registerDate: new Date().toLocaleDateString(), learningHistory: [], totalLearningSeconds: 0, contributionLevel: 1, favorites: [], likedArticles: [] };
    saveUsersDB(db);
    alert("è¨»å†ŠæˆåŠŸ");
    toggleAuthMode('login');
}
function performLogout() {
    saveReadingProgress();
    currentUserData = null;
    document.getElementById("loginUser").value = "";
    document.getElementById("loginPass").value = "";
    showPage("login");
}
function changeUsername() {
    const newName = document.getElementById("newUsername").value.trim();
    if (!newName) { alert("è«‹è¼¸å…¥æ–°çš„åç¨±"); return; }
    if (!currentUserData.originalUsername) currentUserData.originalUsername = currentUserData.username;
    currentUserData.username = newName;
    saveUserData();
    updateUserUI();
    document.getElementById("accountName").innerText = newName;
    alert("åç¨±ä¿®æ”¹æˆåŠŸï¼");
    document.getElementById("newUsername").value = "";
}

function showPage(id){
  if (!currentUserData && id !== 'login') { alert("è«‹å…ˆç™»å…¥"); showPage('login'); return; }
  if(sessionStartTime > 0) saveReadingProgress();
  document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
  const navItem = document.getElementById('nav-' + id);
  if(navItem) navItem.classList.add('active');
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  const targetPage = document.getElementById(id);
  targetPage.style.display="block";
  targetPage.style.animation = 'none';
  targetPage.offsetHeight; 
  targetPage.style.animation = 'fadeInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
  if(id==="explore") setFilter('all', document.querySelector('.filter-btn'));
  if(id==="account") renderAccount();
  if(id==="chatroom") scrollToBottom();
  window.scrollTo(0,0);
}
function toggleAuthMode(mode) {
    document.getElementById("loginForm").style.display = mode === 'login' ? 'block' : 'none';
    document.getElementById("registerForm").style.display = mode === 'register' ? 'block' : 'none';
    document.getElementById("loginError").style.display = 'none';
}
function updateUserUI() {
    if (currentUserData) { document.getElementById("userStatus").innerText = `æ­¡è¿å›ä¾†, ${currentUserData.username}`; }
}

function setFilter(type, btn) {
    currentFilter = type;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderArticles();
}
function renderArticles(filterTag = null) {
    const list = document.getElementById("articleList");
    const searchInput = document.getElementById("searchInput").value.toLowerCase();
    renderHotTags();
    list.innerHTML="";
    
    // ä¾ç†±åº¦æ’åº
    allArticles.sort((a, b) => getArticleHeat(b.id) - getArticleHeat(a.id));

    let filtered = allArticles.filter(a => {
        const matchTag = filterTag ? a.tags.includes(filterTag) : true;
        const matchSearch = (a.title.toLowerCase().includes(searchInput) || a.tags.some(t => t.toLowerCase().includes(searchInput)));
        return matchTag && matchSearch;
    });
    if (currentFilter === 'favorites') {
        const favs = currentUserData.favorites || [];
        filtered = filtered.filter(a => favs.includes(a.id));
    }
    if (filtered.length === 0) { list.innerHTML = `<p style="text-align:center; color:#999; margin-top:30px;">ç„¡ç›¸é—œæ–‡ç« </p>`; return; }
    filtered.forEach((a, index) => {
        const div = document.createElement("div");
        div.className="card article-item";
        div.style.animationDelay = `${index * 0.1}s`;
        const tagsHtml = a.tags.map(t => `<span class="tag" onclick="event.stopPropagation(); renderArticles('${t}')">${t}</span>`).join("");
        const quizBadge = a.quiz ? '<span style="background:var(--success-light); color:var(--success-text); border:1px solid #c3e6cb; font-size:12px; padding:2px 8px; border-radius:10px; margin-left:5px;">ğŸ“ å«æ¸¬é©—</span>' : '';
        const heat = getArticleHeat(a.id);
        const heatDisplay = heat > 0 ? `<div class="heat-badge">ğŸ”¥ ${heat}</div>` : '';
        
        div.innerHTML=`
            <h3>${a.title}${quizBadge}</h3>
            <div class="article-meta"><span>ä½œè€…ï¼š${a.author}</span>${heatDisplay}</div>
            <div class="tag-container" style="margin-bottom:10px;">${tagsHtml}</div>
            <p class="article-desc">${a.content.substring(0,60).replace(/\n/g, ' ')}...</p>
            <div style="text-align:right; font-size:13px; color:var(--primary); font-weight:bold;">é»æ“Šé–±è®€å…¨æ–‡ â†’</div>
        `;
        div.onclick = () => openArticle(a.id);
        list.appendChild(div);
    });
}
function filterArticles() { renderArticles(); }
function renderHotTags() {
    const container = document.getElementById("hotTagsContainer");
    const tagCounts = {};
    allArticles.forEach(a => { a.tags.forEach(t => { tagCounts[t] = (tagCounts[t] || 0) + 1; }); });
    const sortedTags = Object.keys(tagCounts).sort((a,b) => tagCounts[b] - tagCounts[a]).slice(0, 5);
    container.innerHTML = sortedTags.map(t => `<span class="tag" onclick="renderArticles('${t}')">${t}</span>`).join("");
}

/* é–±è®€é‚è¼¯ */
function openArticle(id){
  currentArticle = allArticles.find(a=>a.id===id);
  document.getElementById("detailTitle").innerText = currentArticle.title;
  document.getElementById("detailMeta").innerText = `ä½œè€…ï¼š${currentArticle.author} | æ—¥æœŸï¼š${currentArticle.date || 'ç„¡'}`;
  document.getElementById("detailContent").innerText = currentArticle.content;
  document.getElementById("detailTags").innerHTML = currentArticle.tags.map(t => `<span class="tag">${t}</span>`).join("");
  updateFavBtn();
  updateHeatBtn();
  renderQuiz(currentArticle);
  renderComments();
  showPage("detail");
  sessionStartTime = Date.now(); 
}

function updateFavBtn() {
    const btn = document.getElementById("favBtn");
    const isFav = (currentUserData.favorites || []).includes(currentArticle.id);
    if(isFav) { btn.classList.add("active"); btn.innerHTML = "â™¥ å·²çè—"; } 
    else { btn.classList.remove("active"); btn.innerHTML = "â™¡ çè—"; }
}
function toggleFavorite() {
    if(!currentUserData.favorites) currentUserData.favorites = [];
    const idx = currentUserData.favorites.indexOf(currentArticle.id);
    if(idx === -1) currentUserData.favorites.push(currentArticle.id);
    else currentUserData.favorites.splice(idx, 1);
    saveUserData(); updateFavBtn();
    const btn = document.getElementById("favBtn");
    btn.style.transform = "scale(1.2)"; setTimeout(() => btn.style.transform = "scale(1)", 200);
}

function updateHeatBtn() {
    const btn = document.getElementById("heatBtn");
    const heatCount = getArticleHeat(currentArticle.id);
    document.getElementById("heatCount").innerText = heatCount;
    
    if(!currentUserData.likedArticles) currentUserData.likedArticles = [];
    if(currentUserData.likedArticles.includes(currentArticle.id)) {
        btn.classList.add("active");
        btn.innerHTML = `ğŸ”¥ å·²çµ¦ç« <span id="heatCount">${heatCount}</span>`;
    } else {
        btn.classList.remove("active");
        btn.innerHTML = `ğŸ”¥ çµ¦ç« <span id="heatCount">${heatCount}</span>`;
    }
}
function toggleHeat() {
    if(!currentUserData.likedArticles) currentUserData.likedArticles = [];
    const idx = currentUserData.likedArticles.indexOf(currentArticle.id);
    
    // Toggle logic: click to add, click again to remove
    if(idx === -1) {
        currentUserData.likedArticles.push(currentArticle.id);
        updateArticleHeat(currentArticle.id, 1);
        // Animation
        const btn = document.getElementById("heatBtn");
        btn.style.animation = 'none';
        btn.offsetHeight; 
        btn.style.animation = 'pop 0.4s ease';
    } else {
        currentUserData.likedArticles.splice(idx, 1);
        updateArticleHeat(currentArticle.id, -1);
    }
    saveUserData();
    updateHeatBtn();
}

function renderQuiz(article) {
    const quizContainer = document.getElementById("detailQuiz");
    quizContainer.innerHTML = "";
    if (!article.quiz) return;
    const quizHtml = `
        <div class="quiz-container">
            <div class="quiz-question">${article.quiz.question}</div>
            <div class="quiz-options">
                ${article.quiz.options.map((opt, idx) => `<button class="quiz-btn" onclick="checkAnswer(${idx}, ${article.quiz.correctAnswerIndex}, this)">${opt}</button>`).join('')}
            </div>
            <div id="quizFeedback" class="quiz-feedback">
                <strong>è§£æï¼š</strong><br><span id="quizExplText">${article.quiz.explanation}</span>
            </div>
        </div>`;
    quizContainer.innerHTML = quizHtml;
}
function checkAnswer(selectedIdx, correctIdx, btnElement) {
    const buttons = document.querySelectorAll('.quiz-btn');
    buttons.forEach(btn => btn.disabled = true);
    const feedback = document.getElementById("quizFeedback");
    if (selectedIdx === correctIdx) {
        btnElement.classList.add("correct");
        btnElement.innerText += " (æ­£ç¢º!)";
        if(currentUserData && currentArticle) {
            let record = currentUserData.learningHistory.find(h => h.articleId === currentArticle.id);
            if(!record) {
                record = { articleId: currentArticle.id, title: currentArticle.title, lastAccess: new Date().toLocaleString(), timeSpentSeconds: 0, quizPassed: true };
                currentUserData.learningHistory.unshift(record);
            } else { record.quizPassed = true; }
            saveUserData();
        }
    } else {
        btnElement.classList.add("wrong");
        buttons[correctIdx].classList.add("correct");
        feedback.classList.add("error-feedback");
    }
    feedback.classList.add("show");
}

/* ç™¼å¸ƒæ–‡ç«  */
function submitArticle() {
    const title = document.getElementById("pubTitle").value.trim();
    const content = document.getElementById("pubContent").value.trim();
    const tagsInput = document.getElementById("pubTags").value.trim();
    const quizQ = document.getElementById("quizQuestion").value.trim();
    const quizOpts = [1,2,3,4].map(i => document.getElementById(`quizOpt${i}`).value.trim()).filter(o=>o);
    if (!title || !content) { alert("è«‹è¼¸å…¥æ¨™é¡Œèˆ‡å…§å®¹"); return; }
    let tags = tagsInput.split(/[\s,]+/).filter(t => t.length > 0).map(t => t.startsWith('#') ? t : '#' + t);
    if (tags.length === 0) tags = ["#ä¸€èˆ¬"];
    const newArticle = { id: Date.now(), title, author: currentUserData.username, content, tags, comments: [], date: new Date().toLocaleDateString() };
    if (quizQ && quizOpts.length >= 2) {
        newArticle.quiz = { question: quizQ, options: quizOpts, correctAnswerIndex: parseInt(document.getElementById("quizCorrect").value), explanation: document.getElementById("quizExplanation").value.trim() };
    }
    let userArticles = JSON.parse(localStorage.getItem('flowLearningUserArticles') || "[]");
    userArticles.unshift(newArticle);
    localStorage.setItem('flowLearningUserArticles', JSON.stringify(userArticles));
    allArticles.unshift(newArticle);
    alert("æ–‡ç« ç™¼å¸ƒæˆåŠŸï¼");
    showPage("explore");
}

/* å„€è¡¨æ¿ */
function renderAccount(){
    if (!currentUserData) return;
    document.getElementById("accountName").innerText = currentUserData.username;
    document.getElementById("accountId").innerText = currentUserData.registerDate || "N/A";
    const history = currentUserData.learningHistory || [];
    const totalSec = currentUserData.totalLearningSeconds || 0;
    document.getElementById("readCount").innerText = history.length;
    document.getElementById("totalTime").innerText = Math.floor(totalSec / 60);
    document.getElementById("contributionScore").innerText = `Lv. ${currentUserData.contributionLevel}`;
    const progress = Math.min(100, Math.floor((history.length / 5) * 100));
    document.getElementById("progressBar").style.width = `${progress}%`;
    document.getElementById("progressText").innerText = progress;

    const historyBody = document.getElementById("historyList");
    if(history.length > 0){
        historyBody.innerHTML = history.map((item, index) => {
            const mins = Math.floor(item.timeSpentSeconds / 60);
            const secs = item.timeSpentSeconds % 60;
            
            // ä¿®æ­£ï¼šæ¸¬é©—ç‹€æ…‹é¡¯ç¤ºé‚è¼¯
            let quizStatus = "";
            const article = allArticles.find(a => a.id === item.articleId);
            if (article && !article.quiz) {
                quizStatus = '<span style="color:#6c757d; font-size:13px;">âšª æœ¬å–®å…ƒç„¡æ¸¬é©—</span>';
            } else {
                if (item.quizPassed) quizStatus = '<span style="color:var(--success); font-weight:bold;">âœ… é€šé</span>';
                else quizStatus = '<span style="color:#ffc107;">æœªå®Œæˆ</span>';
            }

            return `<tr style="animation: fadeInUp 0.4s ease forwards; animation-delay: ${index * 0.1}s; opacity: 0;">
                <td><strong>${item.title}</strong></td>
                <td>${item.lastAccess.split(' ')[0]}</td>
                <td><span style="color:var(--primary); font-weight:bold;">${mins}åˆ†${secs}ç§’</span></td>
                <td>${quizStatus}</td>
            </tr>`;
        }).join("");
    } else {
        historyBody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px;">å°šæœªé–‹å§‹å­¸ç¿’</td></tr>';
    }
}

/* ç•™è¨€ */
function renderComments(){
  const box=document.getElementById("detailComments");
  box.innerHTML= currentArticle.comments.map((c,i)=>`<div class="comment" onclick="handleCommentClick(this, '${i+1}æ¨“')"><strong>${i+1}æ¨“:</strong> ${c}</div>`).join("");
}
function handleCommentClick(element, floorName) {
    element.classList.remove("bounce-active"); void element.offsetWidth; element.classList.add("bounce-active");
    const input = document.getElementById("commentInput");
    if(!input.value.includes(`@${floorName}`)) input.value = `@${floorName} ` + input.value;
    input.focus();
}
function addComment(e){
  if(e.key==="Enter" && e.target.value){
    currentArticle.comments.push(`${currentUserData.username}ï¼š${e.target.value}`);
    e.target.value="";
    renderComments();
    currentUserData.contributionLevel += 1;
  }
}
function sendChat(){
    const input = document.getElementById("chatInput");
    if(input.value){
        document.getElementById("chatBox").innerHTML += `<div class="chat-wrapper"><div class="chat-msg my-msg"><strong>${currentUserData.username}:</strong> ${input.value}</div></div>`;
        input.value = "";
        setTimeout(() => { document.getElementById("chatBox").scrollTop = document.getElementById("chatBox").scrollHeight; }, 50);
    }
}
function scrollToBottom(){ setTimeout(() => { document.getElementById("chatBox").scrollTop = document.getElementById("chatBox").scrollHeight; }, 50); }

initArticles();
startTipsRotation();
showPage("login"); 
</script>

</body>
</html>
